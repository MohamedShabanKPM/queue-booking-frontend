<div *ngIf="visible" class="queue-popup-backdrop" (click)="onBackdropClick($event)">
  <div class="queue-popup-dialog" (click)="$event.stopPropagation()">
    <div class="queue-popup-header">
      <h2 class="queue-popup-title">
        <i class="fas fa-ticket-alt"></i> {{ title }}
      </h2>
      <button class="queue-popup-close" (click)="onClose()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="queue-popup-body">
      <div class="popup-title-section">
        <h3>
          <i class="fas fa-ticket-alt"></i> {{ 'details.title' | translate }} #{{ data.queueNumber }}
        </h3>
      </div>
      
      <div class="popup-form-groups">
        <div class="form-group-section">
          <h4>{{ 'customer.title' | translate }}</h4>
          <div class="form-group">
            <label class="form-label">{{ 'customer.name' | translate }}:</label>
            <span class="form-value">{{ data.name || '-' }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">{{ 'customer.phone' | translate }}:</label>
            <span class="form-value">{{ data.phone || '-' }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">{{ 'customer.email' | translate }}:</label>
            <span class="form-value">{{ data.email || '-' }}</span>
          </div>
        </div>
        
        <div class="form-group-section">
          <h4>{{ 'details.title' | translate }}</h4>
          <div class="form-group">
            <label class="form-label">{{ 'details.queueNumber' | translate }}:</label>
            <span class="form-value">#{{ data.queueNumber }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">{{ 'details.status' | translate }}:</label>
            <span [class]="'status-badge ' + getStatusClass(data.status)">
              {{ getStatusTranslation(data.status) }}
            </span>
          </div>
          <div class="form-group">
            <label class="form-label">{{ 'details.window' | translate }}:</label>
            <span class="form-value">{{ data.windowName || (data.windowNumber ? ('booking.window' | translate) + ' ' + data.windowNumber : '-') }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">{{ 'details.date' | translate }}:</label>
            <span class="form-value">{{ data.bookingDate ? (data.bookingDate | date:'short') : '-' }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">{{ 'details.startedBy' | translate }}:</label>
            <span class="form-value">{{ data.startedByName || '-' }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">{{ 'details.startTime' | translate }}:</label>
            <span class="form-value">{{ data.actualStartTime ? (data.actualStartTime | date:'short') : '-' }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">{{ 'details.endTime' | translate }}:</label>
            <span class="form-value">{{ data.actualEndTime ? (data.actualEndTime | date:'short') : '-' }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">{{ 'details.timeTaken' | translate }}:</label>
            <span class="form-value">{{ data.timeTaken || '-' }}</span>
          </div>
        </div>
      </div>
      
      <!-- Status Bar and Buttons -->
      <div *ngIf="statusBar" class="popup-statusbar">
        <div class="queue-statusbar">
          <div class="statusbar-states">
            <span
              *ngFor="let state of statusBar.states"
              [class]="'statusbar-state ' + (state === statusBar.currentState ? 'active' : '')"
              [class.completed]="getStateIndex(state) < getStateIndex(statusBar.currentState)">
              {{ state }}
            </span>
          </div>
        </div>
        <div class="popup-buttons">
          @for (btn of buttons; track btn) {
            @if (btn.visible !== false) {
              <button
                [class]="'btn ' + (btn.class || 'btn-primary')"
                (click)="btn.action()">
                @if (btn.icon) {
                  <i [class]="btn.icon"></i>
                }
                {{ btn.label }}
              </button>
            }
          }
        </div>
      </div>
    </div>
  </div>
</div>
