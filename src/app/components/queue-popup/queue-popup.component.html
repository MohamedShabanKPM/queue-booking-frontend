<div *ngIf="visible" class="queue-popup-backdrop" (click)="onBackdropClick($event)">
  <div class="queue-popup-dialog" (click)="$event.stopPropagation()">
    <div class="queue-popup-header">
      <h2 class="queue-popup-title">
        <i class="fa fa-ticket"></i> {{ title }}
      </h2>
      <button class="queue-popup-close" (click)="onClose()">
        <i class="fa fa-times"></i>
      </button>
    </div>
    <div class="queue-popup-body">
      <div class="popup-title-section">
        <h3>
          <i class="fa fa-ticket"></i> Reservation #{{ data.queueNumber }}
        </h3>
      </div>
      
      <div class="popup-form-groups">
        <div class="form-group-section">
          <h4>Customer Information</h4>
          <div class="form-group">
            <label class="form-label">Name:</label>
            <span class="form-value">{{ data.name || '-' }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">Phone:</label>
            <span class="form-value">{{ data.phone || '-' }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">Email:</label>
            <span class="form-value">{{ data.email || '-' }}</span>
          </div>
        </div>
        
        <div class="form-group-section">
          <h4>Booking Details</h4>
          <div class="form-group">
            <label class="form-label">Queue #:</label>
            <span class="form-value">#{{ data.queueNumber }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">Status:</label>
            <span [class]="'status-badge ' + getStatusClass(data.status)">
              {{ data.status }}
            </span>
          </div>
          <div class="form-group">
            <label class="form-label">Window:</label>
            <span class="form-value">{{ data.windowName || (data.windowNumber ? 'Window ' + data.windowNumber : '-') }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">Date:</label>
            <span class="form-value">{{ data.bookingDate ? (data.bookingDate | date:'short') : '-' }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">Started By:</label>
            <span class="form-value">{{ data.startedByName || '-' }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">Start Time:</label>
            <span class="form-value">{{ data.actualStartTime ? (data.actualStartTime | date:'short') : '-' }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">End Time:</label>
            <span class="form-value">{{ data.actualEndTime ? (data.actualEndTime | date:'short') : '-' }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">Time Taken:</label>
            <span class="form-value">{{ data.timeTaken || '-' }}</span>
          </div>
        </div>
      </div>
      
      <!-- Status Bar and Buttons -->
      <div *ngIf="statusBar" class="popup-statusbar">
        <div class="queue-statusbar">
          <div class="statusbar-states">
            <span
              *ngFor="let state of statusBar.states"
              [class]="'statusbar-state ' + (state === statusBar.currentState ? 'active' : '')"
              [class.completed]="getStateIndex(state) < getStateIndex(statusBar.currentState)">
              {{ state }}
            </span>
          </div>
        </div>
        <div class="popup-buttons">
          @for (btn of buttons; track btn) {
            @if (btn.visible !== false) {
              <button
                [class]="'btn ' + (btn.class || 'btn-primary')"
                (click)="btn.action()">
                @if (btn.icon) {
                  <i [class]="btn.icon"></i>
                }
                {{ btn.label }}
              </button>
            }
          }
        </div>
      </div>
    </div>
  </div>
</div>
